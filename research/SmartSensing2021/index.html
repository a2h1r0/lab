<!doctype html>
<html lang="ja">
<head>
    <title>脈波の生成</title>
    <meta http-equiv="content-type" charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link href="style.css" rel="stylesheet">

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="modal fade" id="welcome" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <h1 class="text-center">脈波の生成デモアプリ</h1>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary mx-auto" data-bs-dismiss="modal">試す</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <div class="alert alert-secondary" id="status">
            <div class="spinner-border spinner-border-sm d-none" role="status"></div>
            <span>目標心拍数：未設定</span>
        </div>

        <input type="number" name="target-heart-rate" placeholder="目標心拍数">
        <button class="btn btn-primary" onclick="submit()" disabled>
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            更新
        </button>
        <p class="text-danger d-none" id="invalid">10~300で入力してください．</p>
    </div>

    <script>
        new bootstrap.Modal(document.getElementById('welcome')).show();

        $('input[name=target-heart-rate]').on('input', function() {
            const val = $(this).val();
            if (val === '' || val < 10 || val > 300) {
                $('button').prop('disabled', true);
                $('#invalid').removeClass('d-none');
            } else {
                $('button').prop('disabled', false);
                $('#invalid').addClass('d-none');
            }
        });
        function submit() {
            const targetHeartRate = $('input[name=target-heart-rate]').val();

            $('button').prop('disabled', true);
            $('button > span').removeClass('d-none');
            $('#status').addClass('alert-primary');
            $('#status').removeClass('alert-secondary');
            $('#status').removeClass('alert-success');
            $('#status > .spinner-border').removeClass('d-none');
            $('#status > span').text('データ送信中．．．');

            $.post({
                url: "http://192.168.137.1:8080/cgi-bin/server.py",
                data: targetHeartRate,
                dataType: "text",
            }).then(function () {
                $('button').prop('disabled', false);
                $('button > span').addClass('d-none');
                $('#status').addClass('alert-success');
                $('#status').removeClass('alert-primary');
                $('#status > .spinner-border').addClass('d-none');
                $('#status > span').text('目標心拍数：' + targetHeartRate);
            });
        }
    </script>
</body>

</html>